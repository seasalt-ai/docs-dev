<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NearMe Bot Architecture &amp; Deployment &mdash; Seasalt.ai Developers 0.0.1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="NearMe Bot Generation" href="nearme_bot_generation.html" />
    <link rel="prev" title="NearMe" href="readme.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >
            <a href="../index.html" class="icon icon-home"> Seasalt.ai Developers
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Product Introductions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../product_introduction/seax.html">SeaX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../product_introduction/seavoice.html">SeaVoice</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">SeaChat</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../seachat/quickstart.html">SeaChat Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../seachat/bot_tutorial.html">SeaChat Bot Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../seachat/policy.html">SeaChat Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../seachat/faq.html">SeaChat FAQ</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">SeaChat-cart</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../cart/readme.html">SeaChat Cart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cart/seachat_cart.html">Technical Docs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">SeaWord</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../nlp/readme.html">SeaWord</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nlp/sum_tutorial.html">Summarization API Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nlp/topic_tutorial.html">Topic Extraction API Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nlp/action_tutorial.html">Action Extraction API Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nlp/xlingualNER_tutorial.html">Cross Lingual NER API Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nlp/mr_tutorial.html">Machine Reading API Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nlp/redaction_tutorial.html">Redaction Service Tutorial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">SeaVoice (Seasalt speech)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../speech/readme.html">SeaVoice README</a></li>
<li class="toctree-l1"><a class="reference internal" href="../speech/seavoice_sdk_python_tutorial.html">SeaVoice SDK (Python)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../speech/seavoice_restful_apis_tutorial.html">SeaVoice RESTful APIs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">NearMe</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="readme.html">NearMe</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">NearMe Bot Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="nearme_bot_generation.html">NearMe Bot Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="nearme_bot_message_routing.html">NearMe Message Routing</a></li>
<li class="toctree-l1"><a class="reference internal" href="nearme_bot_analytics.html">NearMe Conversation Analytics</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_analytics_tutorial.html">NearMe Data Studio Analytics Tutorial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">SeaChat-report</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../report/index.html">Welcome to SeaChat-report’s documentation!</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Seasalt.ai Developers</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>NearMe Bot Architecture &amp; Deployment</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/nearme/nearme_bot_architecture.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="nearme-bot-architecture-deployment">
<span id="nearme-bot-architecture"></span><h1>NearMe Bot Architecture &amp; Deployment<a class="headerlink" href="#nearme-bot-architecture-deployment" title="Permalink to this headline"></a></h1>
<p>This page will walk through the fundamental architecture of the NearMe bot backend and how it is deployed.</p>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#introduction" id="id1">Introduction</a></p></li>
<li><p><a class="reference internal" href="#architecture" id="id2">Architecture</a></p>
<ul>
<li><p><a class="reference internal" href="#bot-template-normalize-the-nlu-model" id="id3">Bot Template: Normalize the NLU Model</a></p></li>
<li><p><a class="reference internal" href="#gbm-master-abstract-the-data" id="id4">GBM Master: Abstract the Data</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#deployment" id="id5">Deployment</a></p></li>
</ul>
</div>
<section id="introduction">
<h2><a class="toc-backref" href="#id1">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline"></a></h2>
<p>Prior to working on NearMe, we had spent a lot of time developing chatbots using Rasa, and had even developed a robust system for building &amp; deploying bots (SeaChat Plugin for VSCode).
However, NearMe presented a lot of unique challenges that forced us to rethink how we created bots.
Since NearMe targets small business owners, our goal was to abstract a lot of the technical details and make bot creation and deployment completely automated, while also allowing self-serve customization.
So, instead of manually creating a new bot for each business, we want something like a template to quickly create a customized version for each business automatically.</p>
</section>
<section id="architecture">
<h2><a class="toc-backref" href="#id2">Architecture</a><a class="headerlink" href="#architecture" title="Permalink to this headline"></a></h2>
<p>Our first version involved creating a set of template bot files that we could copy into a new directory and then replace key variables with parameters from the business.
We re-used a lot of the SeaChat architecture for this, including the GitHub integration and deployment workflows.</p>
<section id="bot-template-normalize-the-nlu-model">
<h3><a class="toc-backref" href="#id3">Bot Template: Normalize the NLU Model</a><a class="headerlink" href="#bot-template-normalize-the-nlu-model" title="Permalink to this headline"></a></h3>
<p>This worked, but we immediately found a pain point: we had to retrain an NLU model each time a change was made to any of the bot files.
Retraining so many models wasted a lot of time and resources, and to make things worse, because all the bots were generated from a template, the NLU model itself was extremely (if not exactly) the same between bots.
The next step of improvement was to completely normalize the NLU model so that we could use the same model for <em>all</em> the bots.
Now, when we want to improve our NLU model, we can update the master data in <code class="docutils literal notranslate"><span class="pre">NearMe/bot_generation/bots/gbm-master</span></code>, retrain it manually, and upload it to AWS fileshare.
Finally, we can update the deployment of the bot to use the new model, and the NLU for all of our NearMe bots will be improved by using the new model!
And most importantly, we only have to train it when we have important changes, not for each bot.</p>
</section>
<section id="gbm-master-abstract-the-data">
<h3><a class="toc-backref" href="#id4">GBM Master: Abstract the Data</a><a class="headerlink" href="#gbm-master-abstract-the-data" title="Permalink to this headline"></a></h3>
<p>The next pain point we found was with deployment.
If we were trying to target hundreds or thousands of small businesses, that would take a huge amount of resources to deploy and maintain!
At that point, each bot required a core pod and an actions pod - each of which has some CPU and RAM overhead.
However, since the bots are for small businesses, often they would be receiving little to no traffic.
Our next goal was to abstract away <em>all</em> of the business-specific data from the actual Rasa bot code.
This way, we can deploy a single “master” pod for Rasa Core and one for the Actions server, and those pods can handle the traffic for <em>all</em> the businesses.</p>
<p>In order to do this, we moved all the bot responses to the <code class="docutils literal notranslate"><span class="pre">actions.py</span></code> file and all the business specific data (name, hours, location, etc.) to external storage (DB, ElasticSearch, and AWS fileshare).
Each time a message comes in, <code class="docutils literal notranslate"><span class="pre">actions.py</span></code> will check which bot it belongs to and then formulate a response based on a template filled with the appropriate business data.
After this fundamental change to the bot architecture, we only have to deploy one instance of the “GBM Master” to each deployment environment (dev, staging, production).
And then each time we create a new bot, we simply make the business data available to the “GBM Master”, and it can immediately start responding to incoming queries.</p>
<a class="reference internal image-reference" href="../_images/scalable_gbm_bot_routing.png"><img alt="../_images/scalable_gbm_bot_routing.png" src="../_images/scalable_gbm_bot_routing.png" style="width: 600px;" /></a>
<p>The routing of messages displayed in this diagram will be discussed in more detail in the routing section.</p>
</section>
</section>
<section id="deployment">
<h2><a class="toc-backref" href="#id5">Deployment</a><a class="headerlink" href="#deployment" title="Permalink to this headline"></a></h2>
<p>In order for a NearMe bot to respond to messages properly, several services must be deployed to the cluster.
In general, we try to have each of the following services deployed to each namespace (dev, staging, production) so that we can test in completely separate environments.
However, <em>all</em> of these services are now deployed via GitHub Actions, so it makes development and deployment very easy.
For all of the following services, when you modify relevant files and push those changes upstream, it will re-deploy the service to the <code class="docutils literal notranslate"><span class="pre">dev</span></code> environment.
When you merge changes into the <code class="docutils literal notranslate"><span class="pre">staging</span></code> branch, it will re-deploy the service to the <code class="docutils literal notranslate"><span class="pre">staging</span></code> environment.
Finally, when you create a GitHub Release, it will deploy the changes to <code class="docutils literal notranslate"><span class="pre">production</span></code>.</p>
<p><strong>GBM Bot Master</strong>:
The GBM bot master core pod and actions pod must both be deployed. The files can be found in <code class="docutils literal notranslate"><span class="pre">NearMe/bot_generation/bots/gbm-master</span></code>. These pods handle incoming user messages and return bot responses.</p>
<p><strong>FAQ Reranker API</strong>:
Most bot responses rely on the FAQ and MR systems to find the best response. These files can be found in <code class="docutils literal notranslate"><span class="pre">SeaWord/faq_reranker</span></code>.</p>
<p><strong>Machine Reading API</strong>:
The MR endpoints in the FAQ Reranker API rely on the Machine Reading API for span selection. This API is currently <em>not</em> deployed via CI/CD, and must be done manually. The file are at <code class="docutils literal notranslate"><span class="pre">SeaWord/machine_reading</span></code>.</p>
<p><strong>Bot Routing API</strong>:
In order for user messages to be routed from GBM to the bot or a live agent, and visa versa, the bot router must be deployed. The files are in <code class="docutils literal notranslate"><span class="pre">SeaX/bot_routing</span></code>.</p>
<p><strong>Bot Generation API</strong>:
The self-serve features of the NearMe website rely on the bot generation API. Additionally, the bot router uses endpoints in the bot generation API to fetch important info about the bot in order to route messages properly. These files are in <code class="docutils literal notranslate"><span class="pre">NearMe/bot_generation</span></code>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="readme.html" class="btn btn-neutral float-left" title="NearMe" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="nearme_bot_generation.html" class="btn btn-neutral float-right" title="NearMe Bot Generation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2021, Seasalt.ai.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-10405841-8"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-10405841-8', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>