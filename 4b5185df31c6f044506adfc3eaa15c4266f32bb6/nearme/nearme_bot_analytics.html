<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NearMe Bot Query Analytics &mdash; Seasalt.ai Developers 0.0.1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Data Analytics with Google Data Studio Tutorial" href="data_analytics_tutorial.html" />
    <link rel="prev" title="NearMe Bot Message Routing" href="nearme_bot_message_routing.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >
            <a href="../index.html" class="icon icon-home"> Seasalt.ai Developers
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Product Introductions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../product_introduction/seax.html">SeaX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../product_introduction/seavoice.html">SeaVoice</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">SeaChat</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../seachat/quickstart.html">SeaChat Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../seachat/bot_tutorial.html">SeaChat Bot Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../seachat/policy.html">SeaChat Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../seachat/faq.html">SeaChat FAQ</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">SeaChat-cart</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../cart/readme.html">SeaChat Cart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cart/seachat_cart.html">Technical Docs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">SeaWord</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../nlp/readme.html">SeaWord</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nlp/sum_tutorial.html">Summarization API Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nlp/topic_tutorial.html">Topic Extraction API Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nlp/action_tutorial.html">Action Extraction API Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nlp/xlingualNER_tutorial.html">Cross Lingual NER API Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nlp/mr_tutorial.html">Machine Reading API Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nlp/redaction_tutorial.html">Redaction Service Tutorial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">SeaVoice (Seasalt speech)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../speech/readme.html">SeaVoice README</a></li>
<li class="toctree-l1"><a class="reference internal" href="../speech/seavoice_sdk_python_tutorial.html">SeaVoice SDK (Python)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../speech/seavoice_restful_apis_tutorial.html">SeaVoice RESTful APIs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">NearMe</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="readme.html">NearMe</a></li>
<li class="toctree-l1"><a class="reference internal" href="nearme_bot_architecture.html">NearMe Bot Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="nearme_bot_generation.html">NearMe Bot Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="nearme_bot_message_routing.html">NearMe Message Routing</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">NearMe Conversation Analytics</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_analytics_tutorial.html">NearMe Data Studio Analytics Tutorial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">SeaChat-report</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../report/index.html">Welcome to SeaChat-report’s documentation!</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Seasalt.ai Developers</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>NearMe Bot Query Analytics</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/nearme/nearme_bot_analytics.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="nearme-bot-query-analytics">
<span id="nearme-bot-analytics"></span><h1>NearMe Bot Query Analytics<a class="headerlink" href="#nearme-bot-query-analytics" title="Permalink to this headline"></a></h1>
<p>This page will look at how we provide detailed conversation analytics to users of NearMe.</p>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#capturing-data" id="id1">Capturing Data</a></p></li>
<li><p><a class="reference internal" href="#generating-analytics-reports" id="id2">Generating Analytics Reports</a></p>
<ul>
<li><p><a class="reference internal" href="#implementation-streamlit" id="id3">Implementation - Streamlit</a></p></li>
</ul>
</li>
</ul>
</div>
<section id="capturing-data">
<h2><a class="toc-backref" href="#id1">Capturing Data</a><a class="headerlink" href="#capturing-data" title="Permalink to this headline"></a></h2>
<p>In the message routing section, we already went over how we store conversation data to the <code class="docutils literal notranslate"><span class="pre">nearme_events</span></code> table.
General conversation data is great for extracting information like how many unique users talked to the bot, how many queries there were in a certain time frame, and how long the average conversation was.
However, this data can’t tell us much about how well the bot performed or how satisfied the user was with the answers.</p>
<p>In order to provide more detailed analytics about response quality, we created a new table to store information about problematic responses.
In particular, we currently store data about three specific kinds of bot responses.</p>
<p>1. “Missing attribute” FAQs:
This is a situation where the bot responds with a generated FAQ response based on a GBP attribute, but the business owner didn’t specify the attribute value.
For example, if a user asks: “do you serve alcohol?”, the bot may recognize that the user is asking about the Google attribute “serves alcohol”.
However, if the business owner did not fill in that attribute on their Google Business Profile, the bot doesn’t know if it’s applicable to that business or not.
So, the bot will respond with something like “I think you asked about ‘serves alcohol’, but I couldn’t find anything about that…”.
In this case, we store the “missing attribute” FAQs so that we can bring frequently asked attributes to the business owner’s attention, and prompt them to update their Google Profile.</p>
<p>2. Unhelpful MR Responses:
After the bot returns a response from the machine reading system, it always asks a follow up question asking the user if the response was helpful or not.
If the user ever responds “No” to this survey, we store the data so that business owners can tune their reviews and additional context to answer the question better.</p>
<p>3. Fallback:
In the worst case, the bot will have no confident response at all, and will respond with something like “I’m not sure I understood that…”.
We store these queries so that the business owner can fill in the gaps by adding new custom FAQs or additional context.</p>
<p>Within the bot, each time it sends a response to the user, it is checking for any of these three cases.
If a bad response is found, the bot’s action server will submit a request to the endpoint <code class="docutils literal notranslate"><span class="pre">POST</span> <span class="pre">https://seachat.seasalt.ai/bot-actions/nearme_bots/{bot_id}/analytics</span></code> in order to save that data to the database.</p>
<p>The database has the following format:</p>
<p><strong>nearme_query_analytics</strong></p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 23%" />
<col style="width: 9%" />
<col style="width: 45%" />
<col style="width: 23%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Column</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Example</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>bot_id</p></td>
<td><p>str</p></td>
<td><p>The unique bot ID assigned by the backend API</p></td>
<td><p>91b7d5b9-d071-4da9-ab7d-8302eed441f6</p></td>
</tr>
<tr class="row-odd"><td><p>conversation_id</p></td>
<td><p>str</p></td>
<td><p>The unique ID for the conversation provided by GBM. One user/agent pair always has the same ID.</p></td>
<td><p>fa34a02c-8e67-47af-b241-5499a978b7be</p></td>
</tr>
<tr class="row-even"><td><p>timestamp</p></td>
<td><p>float</p></td>
<td><p>The timestamp of the event</p></td>
<td><p>1642635744.4679022</p></td>
</tr>
<tr class="row-odd"><td><p>query</p></td>
<td><p>str</p></td>
<td><p>The original text query from the user</p></td>
<td><p>Do you sell alcohol?</p></td>
</tr>
<tr class="row-even"><td><p>response_type</p></td>
<td><p>str</p></td>
<td><p>The response method of the bot: faq, mr, or fallback</p></td>
<td><p>faq</p></td>
</tr>
<tr class="row-odd"><td><p>bot_response</p></td>
<td><p>str</p></td>
<td><p>The text response from the bot</p></td>
<td><p>I think you asked about “sells alcohol”, but I couldn’t find a good answer.</p></td>
</tr>
<tr class="row-even"><td><p>attribute</p></td>
<td><p>str</p></td>
<td><p>The attribute of the FAQ - only provided when <code class="docutils literal notranslate"><span class="pre">response_type</span></code> == <code class="docutils literal notranslate"><span class="pre">faq</span></code></p></td>
<td><p>sells_alcohol</p></td>
</tr>
<tr class="row-odd"><td><p>has_attribute</p></td>
<td><p>bool</p></td>
<td><p>Whether or not the attribute info was filled in for the business in Google Business Profile - only provided when <code class="docutils literal notranslate"><span class="pre">response_type</span></code> == <code class="docutils literal notranslate"><span class="pre">faq</span></code></p></td>
<td><p>False</p></td>
</tr>
<tr class="row-even"><td><p>helpful_response</p></td>
<td><p>bool</p></td>
<td><p>Whether or not the user thought the response was helpful - only provided when <code class="docutils literal notranslate"><span class="pre">response_type</span></code> == <code class="docutils literal notranslate"><span class="pre">mr</span></code></p></td>
<td><p>True</p></td>
</tr>
<tr class="row-odd"><td><p>processed</p></td>
<td><p>bool</p></td>
<td><p>Whether or not the issue with the query has been addressed by the business owner</p></td>
<td><p>True</p></td>
</tr>
</tbody>
</table>
</section>
<section id="generating-analytics-reports">
<h2><a class="toc-backref" href="#id2">Generating Analytics Reports</a><a class="headerlink" href="#generating-analytics-reports" title="Permalink to this headline"></a></h2>
<p>Using the conversation data captured, we can provide real time key metrics and insights for NearMe users. NearMe Analytics dashboard is a self-contained service that can be managed by NLP Team and accessed on demand by Front/Back-end teams.</p>
<section id="implementation-streamlit">
<h3><a class="toc-backref" href="#id3">Implementation - Streamlit</a><a class="headerlink" href="#implementation-streamlit" title="Permalink to this headline"></a></h3>
<p>We choose <a class="reference external" href="https://streamlit.io/">Streamlit</a> to host the NearMe analytics application. To learn more about how to get started with Streamlit, please check out this <a class="reference external" href="https://docs.google.com/presentation/d/12M-D3Bni_yQhiGy89Q6lMsWenr7-fALM9lOzfrp3LkI/edit?usp=sharing">Seminar</a>. Following are the implementation details for the NearMe Analytics Dashboard:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Project Structure</span>
<span class="o">|</span> <span class="n">customers_analytics</span>
    <span class="o">|</span> <span class="o">.</span><span class="n">streamlit</span>
        <span class="o">|</span> <span class="n">config</span><span class="o">.</span><span class="n">toml</span>
    <span class="o">|</span> <span class="n">app</span><span class="o">.</span><span class="n">py</span>
    <span class="o">|</span> <span class="n">queries</span><span class="o">.</span><span class="n">py</span>
    <span class="o">|</span> <span class="n">Dockerfile</span>
    <span class="o">|</span> <span class="n">start</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Using analytics database and SQL queries</p></li>
</ul>
<p>To have real time analytics on demand, we decide to extract useful information from bot logs and set aside a database for analytics. Having a separate database for analytics allows NLP to add more useful information quickly without interfering with production and other team’s workflow. The database name is <code class="docutils literal notranslate"><span class="pre">nlp-{environment}</span></code>, for example, <code class="docutils literal notranslate"><span class="pre">nlp-dev</span></code>. After consolidating the SQL queries for the metrics we want to show, we organize the queries into functions that we can use on demand. We can repeatedly run these queries with different <code class="docutils literal notranslate"><span class="pre">bot_id</span></code> and <code class="docutils literal notranslate"><span class="pre">date</span> <span class="pre">range</span></code>. All queries are currently saved in <code class="docutils literal notranslate"><span class="pre">queries.py</span></code>.</p>
<ul class="simple">
<li><p>Real time rendering</p></li>
</ul>
<p>The dashboard will rerender whenever 1) a user opens the analytics app 2) a user changes date range for analytics data. This allows users to see insights for any specific time range. Internally, this is also useful for NLP Team to check the metrics for any bot given a bot id.</p>
<ul class="simple">
<li><p>Making graphs</p></li>
</ul>
<p>We primarily use the python package, <code class="docutils literal notranslate"><span class="pre">altair</span></code>, to make the analytics graphs. It is possible to use other common Python visualization libraries. The graphs will rerender as soon as the app receives new data. It is possible to customize all the graphs (fonts, size, position, orientation etc). Most customization tricks can be found at <a class="reference external" href="https://altair-viz.github.io/">altair documentation</a>.</p>
<ul class="simple">
<li><p>App Theme and Design</p></li>
</ul>
<p>Since one goal is to have seamless integration with NearMe Portal, we customize a Seasalt theme for Analytics Dashboard. Please check out the seminar for details on how to add a theme to streamlit app. The theme details are stored in <code class="docutils literal notranslate"><span class="pre">.streamlit/config.toml</span></code>.</p>
<ul class="simple">
<li><p>Passing in query parameter in URL</p></li>
</ul>
<p>We want to use one single service for all the bot analytics so it is important that we can provide contexts such as <code class="docutils literal notranslate"><span class="pre">bot_id</span></code> to render the Analytics Dashboard accordingly. If we need to pass in more contexts to the app when opening the Dashboard, we can just append more parameters to the URL like how you’d add query parameter strings in REST API requests, and then just adjust the Python code accordingly to parse out the query parameters.</p>
<p>Currently, there are 3 parameters required to render the Analytics dashboard:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">bot_id</span></code> - <code class="docutils literal notranslate"><span class="pre">bot_id</span></code> in <code class="docutils literal notranslate"><span class="pre">nlp_{env}.nearme_bots</span></code> table</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">location_id</span></code> - <code class="docutils literal notranslate"><span class="pre">ID</span></code> in <code class="docutils literal notranslate"><span class="pre">ngchat_{env}.gmb_location</span></code> table</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tz</span></code> - We use the <a class="reference external" href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones">timezone database standard</a>, e.g. <code class="docutils literal notranslate"><span class="pre">America/Los_Angeles</span></code>. The default is the user’s browser timezone.</p></li>
</ol>
</div></blockquote>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="nearme_bot_message_routing.html" class="btn btn-neutral float-left" title="NearMe Bot Message Routing" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="data_analytics_tutorial.html" class="btn btn-neutral float-right" title="Data Analytics with Google Data Studio Tutorial" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2021, Seasalt.ai.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-10405841-8"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-10405841-8', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>