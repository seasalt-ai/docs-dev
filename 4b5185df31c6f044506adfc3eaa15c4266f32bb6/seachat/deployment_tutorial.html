

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>SeaChat Deployment Tutorial &mdash; SeaChat 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Bot Tutorial Example Files" href="example_files.html" />
    <link rel="prev" title="SeaChat FAQ Tutorial" href="faq_tutorial.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> SeaChat
          

          
            
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Product Introductions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../product_introduction/seax.html">SeaX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../product_introduction/seavoice.html">SeaVoice</a></li>
</ul>
<p class="caption"><span class="caption-text">SeaChat</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">SeaChat Quick Start</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="bot_tutorial.html">SeaChat Bot Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="policy_tutorial.html">SeaChat Policy Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cart/tutorial.html">SeaChat Cart Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq_tutorial.html">SeaChat FAQ Tutorial</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">SeaChat Deployment Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_files.html">Bot Tutorial Example Files</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="policy.html">SeaChat Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">SeaChat FAQ</a></li>
</ul>
<p class="caption"><span class="caption-text">SeaChat-cart</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../cart/readme.html">SeaChat Cart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cart/seachat_cart.html">Technical Docs</a></li>
</ul>
<p class="caption"><span class="caption-text">SeaWord</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../nlp/readme.html">SeaWord</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nlp/sum_tutorial.html">Summarization API Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nlp/topic_tutorial.html">Topic Prediction API Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nlp/action_tutorial.html">Action Extraction API Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nlp/xlingualNER_tutorial.html">Cross Lingual NER API Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nlp/mr_tutorial.html">Machine Reading API Tutorial</a></li>
</ul>
<p class="caption"><span class="caption-text">SeaVoice (Seasalt speech)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../speech/readme.html">SeaVoice README</a></li>
<li class="toctree-l1"><a class="reference internal" href="../speech/seavoice_sdk_python_tutorial.html">SeaVoice SDK (Python)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../speech/seavoice_restful_apis_tutorial.html">SeaVoice RESTful APIs</a></li>
</ul>
<p class="caption"><span class="caption-text">SeaChat-report</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../report/index.html">Welcome to SeaChat-report’s documentation!</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">SeaChat</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="bot_tutorial.html">SeaChat Bot Tutorial</a> &raquo;</li>
        
      <li>SeaChat Deployment Tutorial</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/seachat/deployment_tutorial.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="seachat-deployment-tutorial">
<span id="deployment-tutorial"></span><h1>SeaChat Deployment Tutorial<a class="headerlink" href="#seachat-deployment-tutorial" title="Permalink to this headline">¶</a></h1>
<p>By this point, you should have your first working chatbot! However, your bot won’t do any good if it’s stuck on your local machine. The next step is to deploy the bot to a computing cluster where it can run 24/7 and eventually be accessed by users via an external channel (such a Facebook messenger, Slack, or Google Business Messages).</p>
<div class="section" id="deployment-process-overview">
<h2>Deployment Process Overview<a class="headerlink" href="#deployment-process-overview" title="Permalink to this headline">¶</a></h2>
<p>Seasalt uses <a class="reference external" href="https://azure.microsoft.com/en-us/">Microsoft Azure</a> for cloud computing and deployment. Within Azure, we use  <a class="reference external" href="https://kubernetes.io/">Kubernetes</a>, a system for container deployment, scaling, and management.</p>
<p>Here’s a fundamental <a class="reference external" href="https://www.youtube.com/watch?v=3Arj5zlUPG4">intro to cloud computing and Microsoft Azure</a>.</p>
<p>Here’s an introduction to <a class="reference external" href="https://www.youtube.com/watch?v=VnvRFRk_51k">Kubernetes</a>.</p>
<p>The Seasalt cluster has two main environments: the staging environment and the production environment. The staging environment is where active development takes place - developers may be frequently training and testings new versions of their bots in staging. The production environment, on the other hand, is tightly controlled and only contains the best working version of each deployed bot. In most cases, the bot developer will only interact with the staging server. The desired workflow involves the developer iterating on bot improvements within the staging cluster, then alerting the release manager when the changes are ready to be implemented in the production environment. Before moving to production, the new changes must be confirmed to work as expected in the staging environment, reviewed thoroughly by team members in a pull request, and merged into the master branch in the github repository. Once all these steps are completed, the developer should work with the release manager to select which commits should be moved to production. The release manager will then package up the changes and deploy them to the production environment.</p>
<img alt="../_images/deployment_workflow.png" src="../_images/deployment_workflow.png" />
</div>
<div class="section" id="seachat-extension">
<h2>SeaChat Extension<a class="headerlink" href="#seachat-extension" title="Permalink to this headline">¶</a></h2>
<p>Bot deployment to the Seasalt cluster is facilitated by the SeaChat extension. Through the extension you can register a new bot on the cluster, train &amp; save a model, and deploy a bot to staging environment.</p>
</div>
<div class="section" id="extension-setup">
<h2>Extension Setup<a class="headerlink" href="#extension-setup" title="Permalink to this headline">¶</a></h2>
<p>You must be using the <a class="reference external" href="https://code.visualstudio.com/download">VSCode IDE</a> to use the SeaChat Extension. Within VSCode, go to the extensions marketplace, search for <cite>SeaChat</cite>, and click <code class="docutils literal notranslate"><span class="pre">install</span></code>.</p>
<img alt="../_images/install_ngchat_extension.png" src="../_images/install_ngchat_extension.png" />
<p>You should now see a new extension with the SeaChat logo on the left hand toolbar. Before interacting with the SeaChat extension, make sure that the settings are configured properly. Go to <code class="docutils literal notranslate"><span class="pre">File</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">Preferences</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">Settings</span></code>, and search for <cite>SeaChat</cite>. Make sure that the <code class="docutils literal notranslate"><span class="pre">APIHost</span></code> field has the following url: <code class="docutils literal notranslate"><span class="pre">https://SeaChat-backstage.seasalt.ai/</span></code>.</p>
<img alt="../_images/setup_ngchat_api_settings.png" src="../_images/setup_ngchat_api_settings.png" />
<div class="section" id="registering-a-new-bot">
<h3>Registering a New Bot<a class="headerlink" href="#registering-a-new-bot" title="Permalink to this headline">¶</a></h3>
<p>Once this is configured, you can navigate to the SeaChat extension and login with your Seasalt username and password. You should see a list of all available bots in your current working directory. You may notice that it says <code class="docutils literal notranslate"><span class="pre">Invalid</span></code> next to some bots’ names. This means that the bot has not yet been registered on the Seasalt cluster. To register a new bot, click the bot name to open the drop down menu and click <code class="docutils literal notranslate"><span class="pre">Please</span> <span class="pre">register</span> <span class="pre">the</span> <span class="pre">bot</span></code>.</p>
<img alt="../_images/register_bot_extension.png" src="../_images/register_bot_extension.png" />
<p>If the bot registration is successful, you should see a new file called <code class="docutils literal notranslate"><span class="pre">.ngChat.bot</span></code> appear in the bot directory. This file contains an encrypted version of the bot’s new ID. This ID will be used in several places, including in the bot’s webhook when it is connected to an external channel.</p>
<img alt="../_images/registered_bot_files.png" src="../_images/registered_bot_files.png" />
</div>
<div class="section" id="training-deploying-a-bot">
<h3>Training &amp; Deploying a Bot<a class="headerlink" href="#training-deploying-a-bot" title="Permalink to this headline">¶</a></h3>
<p>Now that the bot is registered, you should see some new options in the dropdown menu within the extension. If you click on <code class="docutils literal notranslate"><span class="pre">SeaChat</span> <span class="pre">Workflow</span></code>, you should see two options: <code class="docutils literal notranslate"><span class="pre">Train</span> <span class="pre">E2E</span></code> and <code class="docutils literal notranslate"><span class="pre">Model</span> <span class="pre">List</span></code>. To train a bot, simply click the <code class="docutils literal notranslate"><span class="pre">Train</span> <span class="pre">E2E</span></code> button. Make sure that your most recent work is committed and pushed up to the remote repository. If you have un-committed or un-pushed changes, the extension will ask you how to proceed. Once you start the training, you should see a training status notification in the bottom right. If an error occurs during training, you will see an error message in the same location.</p>
<img alt="../_images/bot_actions_extension.png" src="../_images/bot_actions_extension.png" />
<p>Once the bot is successfully trained, click the <code class="docutils literal notranslate"><span class="pre">Model</span> <span class="pre">List</span></code> button to see your available models. To deploy a model to the staging environment, click the <code class="docutils literal notranslate"><span class="pre">Active</span></code> button on the model you want to deploy. While in the process of deploying to the cluster, the <code class="docutils literal notranslate"><span class="pre">Active</span></code> button will flash green. Once the deployment is completed, the active model will show as solid green.</p>
<img alt="../_images/model_list.png" src="../_images/model_list.png" />
</div>
<div class="section" id="other-extension-capabilities">
<h3>Other Extension Capabilities<a class="headerlink" href="#other-extension-capabilities" title="Permalink to this headline">¶</a></h3>
<p>You may have noticed that each bot also has <code class="docutils literal notranslate"><span class="pre">Conversations</span></code> and <code class="docutils literal notranslate"><span class="pre">Configuration</span></code> tabs in the extension. These features are not fully fleshed out yet - feel free to play around with them, and stay tuned for updates.</p>
</div>
</div>
<div class="section" id="debugging-on-the-cluster">
<h2>Debugging on the Cluster<a class="headerlink" href="#debugging-on-the-cluster" title="Permalink to this headline">¶</a></h2>
<p>Occasionally when deploying to the cluster, you will encounter errors that you did not see locally. Most often this is due to a dependency issue on the cluster, an error from the external channel (such as FB or GBM), or an issue with the bot’s container. In order to debug these issues, you will likely need to access the cluster directly.</p>
<div class="section" id="local-setup">
<h3>Local Setup<a class="headerlink" href="#local-setup" title="Permalink to this headline">¶</a></h3>
<p>First, install <a class="reference external" href="https://kubernetes.io/docs/tasks/tools/">Kubernetes</a> and <a class="reference external" href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli">Azure CLI</a>. Next, <a class="reference external" href="https://docs.microsoft.com/en-us/cli/azure/authenticate-azure-cli">login to Azure</a> from your local machine. Finally, get the <a class="reference external" href="https://docs.microsoft.com/en-us/cli/azure/acs/kubernetes?view=azure-cli-latest#az_acs_kubernetes_get_credentials">Kubernetes credentials</a>. For this last step, you may need to ask you supervisor to give your account the proper permissions through Azure; also ask your supervisor for the cluster name and resource group information.</p>
</div>
<div class="section" id="accessing-the-cluster">
<h3>Accessing the Cluster<a class="headerlink" href="#accessing-the-cluster" title="Permalink to this headline">¶</a></h3>
<p>Once you are set up with the proper credentials, you should be able to access the cluster on you local machine. Try running <code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">kubectl</span> <span class="pre">get</span> <span class="pre">pods</span> <span class="pre">-n</span> <span class="pre">staging</span></code>, and you should get a response like this:</p>
<img alt="../_images/kubectl_get_pods.png" src="../_images/kubectl_get_pods.png" />
<p>In general, each bot has two pods: a core pod (which is running the main rasa service) and an actions pod (which is running the actions server). You can check the age of the pod in the far right column; this number is reset each time the bot is re-deployed, so you can check if your deployment process completed recently or not. In the <code class="docutils literal notranslate"><span class="pre">STATUS</span></code> column, you hope to see <code class="docutils literal notranslate"><span class="pre">Running</span></code>. You may also see <code class="docutils literal notranslate"><span class="pre">ContainerCreating</span></code> or <code class="docutils literal notranslate"><span class="pre">ContainerTerminating</span></code>, this usually means that the deployment process if finishing up, so try waiting a few more minutes. Any other status, especially <code class="docutils literal notranslate"><span class="pre">CrashLoopBackOff</span></code>, usually signals an issue on the cluster side, so it’s probably best to bring that to the attention of a supervisor.</p>
<p>If the pod successfully deployed but is not responding, it may be an issue with the bot itself. You can check the logs of a pod with the following command: <code class="docutils literal notranslate"><span class="pre">kubectl</span> <span class="pre">logs</span> <span class="pre">-f</span> <span class="pre">{full</span> <span class="pre">pod</span> <span class="pre">name}</span> <span class="pre">-n</span> <span class="pre">staging</span></code>. The <code class="docutils literal notranslate"><span class="pre">-f</span></code> flag means that the logs will display in real time until you kill the process. From these logs you should be able to see messages coming in from external sources as well as from the monitor (which sends a message to each bot every few seconds to make sure that they are all responding). You should also see the bot’s response.</p>
<p>If the bot failed during training or deployment, you won’t be able to find the issue within the bot’s pods, because the new pods were not successfully created. Instead, you’ll need to look at the logs of the <code class="docutils literal notranslate"><span class="pre">trainer-worker</span></code> pod. This pod is in charge of queuing and executing the train and deploy jobs.</p>
<p>If you have checked the status of the pod and the logs and everything looks okay, but you’re still encountering an issue, some more in-depth debugging may be necessary; talk to your supervisor.</p>
</div>
<div class="section" id="kubernetes-quality-of-life">
<h3>Kubernetes Quality of Life<a class="headerlink" href="#kubernetes-quality-of-life" title="Permalink to this headline">¶</a></h3>
<p>There are some resources that will improve your quality of life working with Kubernetes.</p>
<p><a class="reference external" href="https://github.com/databricks/click">Click</a> is a tool to make repeated <code class="docutils literal notranslate"><span class="pre">kubectl</span></code> tasks less awful. Start click by invoking the <code class="docutils literal notranslate"><span class="pre">click</span></code> command from the command-line. You can use the <code class="docutils literal notranslate"><span class="pre">help</span></code> command for a list of available commands. You
will most likely want to start by using the <code class="docutils literal notranslate"><span class="pre">context</span></code> command to set the
current context to the <code class="docutils literal notranslate"><span class="pre">ngchat-dev-cluster</span></code></p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">context</span> <span class="pre">ngchat-dev-cluster</span></code></p>
</div></blockquote>
<p>Next, select a namespace, for example:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">namespace</span> <span class="pre">staging</span></code></p>
</div></blockquote>
<p>To get a list of the pods running in this namespace, use the <code class="docutils literal notranslate"><span class="pre">pods</span></code> command.
Rather than running a command and specifying the target object, enter a number
from the list to change the current context, as shown in the command prompt,
then enter a command to be run against the currently selected object.
For example, to delete a pod, run the <code class="docutils literal notranslate"><span class="pre">pods</span></code> command to get the list of pods,
enter the number corresponding to the pod you wish to delete, then enter the
<code class="docutils literal notranslate"><span class="pre">delete</span></code> command.
To back out of a selected context, use the <code class="docutils literal notranslate"><span class="pre">clear</span></code> command.
Use the <code class="docutils literal notranslate"><span class="pre">exit</span></code> command to quit.</p>
<hr class="docutils" />
<p><a class="reference external" href="https://github.com/wercker/stern">Stern</a> is a tool for following logs based on
a regular expression, rather than an individual container ID. This means you do
not need to re-run your <code class="docutils literal notranslate"><span class="pre">kubectl</span> <span class="pre">logs</span> <span class="pre">-f</span></code> command even if, for example, you
delete and re-create a pod.</p>
<p>Download an appropriate binary from
<a class="reference external" href="https://github.com/wercker/stern/releases">here</a>, and copy it to somewhere in your
path as <code class="docutils literal notranslate"><span class="pre">stern</span></code>. e.g:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">sudo</span> <span class="pre">cp</span> <span class="pre">~/Downloads/stern_linux_amd64</span> <span class="pre">/usr/local/bin/stern</span></code></p>
</div></blockquote>
<p>You may also need to make the binary executable:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">sudo</span> <span class="pre">chmod</span> <span class="pre">+x</span> <span class="pre">/usr/local/stern</span></code></p>
</div></blockquote>
<p>To follow the logs of any container in a trainer-worker pod, for example,
run the following: <code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">stern</span> <span class="pre">trainer-worker-.*</span></code>.
The pod query is a regular expression, meaning you can use any regular expressions
to filter the output.</p>
<hr class="docutils" />
<p>Finally, Microsoft has a tutorial and extension for working with Kubernetes in VSCode, which you can find <a class="reference external" href="https://code.visualstudio.com/docs/azure/kubernetes">here</a>.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="example_files.html" class="btn btn-neutral float-right" title="Bot Tutorial Example Files" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="faq_tutorial.html" class="btn btn-neutral float-left" title="SeaChat FAQ Tutorial" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Seasalt.ai

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-10405841-8', 'auto');
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>